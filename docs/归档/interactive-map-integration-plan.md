# 互动地图与世界分析整合计划

> 将世界分析模块的功能整合到互动地图中，形成统一的 Dota 2 地图分析工具

---

## 背景

目前项目中存在两份计划：
- **[ward-simulator-plan.md](./ward-simulator-plan.md)**：眼位模拟器 + 互动地图（已完成 Phase 1-7 大部分功能）
- **[world-analysis-plan.md](./world-analysis-plan.md)**：世界数据分析模块（7 个分析维度，尚未实现）

经分析，互动地图已具备强大的基础设施（时间轴、图层系统、寻路、视野模拟），可以高效承载世界分析的大部分功能。

---

## 互动地图现有能力

| 能力 | 状态 | 说明 |
|------|------|------|
| Canvas 高精度渲染 | ✅ | 2401×2401 分辨率，8单位网格 |
| 时间轴系统 | ✅ | 0-60分钟 + 播放/暂停 + 速度控制 |
| 日夜循环 | ✅ | 每5分钟切换，蓝色夜间光效 |
| 实体图层系统 | ✅ | 野怪/塔/神符/树木/建筑 |
| A* 寻路 | ✅ | 支持砍树联动 |
| 视野模拟 | ✅ | 高地遮挡 + 战争迷雾 + 建筑视野 |
| 右键菜单交互 | ✅ | 起点/终点/清野/砍树 |
| 点击详情浮窗 | ✅ | 野怪营地详情 |

---

## 整合方案

### Phase A：低成本高收益（复用现有基础）

#### A1. 野怪经济面板
- **来源**：world-analysis 第 3 节「野怪金钱与经验」
- **复用**：野怪营地图层 + 时间轴联动 + 点击详情浮窗
- **新增**：
  - [ ] 营地详情浮窗中添加经济数据（金钱/经验/刷新时间）
  - [ ] 时间轴联动显示当前分钟的野怪价值
  - [ ] 清野状态影响经济计算

#### A2. 建筑属性面板
- **来源**：world-analysis 第 4 节「建筑基本属性」
- **复用**：塔/基地/兵营图层 + 点击详情浮窗
- **新增**：
  - [ ] 建筑详情浮窗（HP/护甲/攻击力/攻速）
  - [ ] 推塔时间计算器（输入 DPS → 输出所需时间）
  - [ ] 不同等级塔的数据差异

#### A3. 移动时间显示增强
- **来源**：world-analysis 第 1 节「地图与移速」
- **复用**：A* 寻路 + 起点/终点系统 **已完成**
- **新增**：
  - [ ] 移速输入框（默认 300）
  - [ ] 路径信息面板：距离（单位） + 预计时间（秒）
  - [ ] 不同移速对比显示

---

### Phase B：新增资源图层

#### B1. 中立资源刷新
- **来源**：world-analysis 第 5 节「中立资源刷新机制」
- **新增图层**：
  - [ ] 赏金符文点（4个，每 4 分钟刷新）
  - [ ] 莲花池（每 3 分钟生成 1 朵，最多 6 朵）
  - [ ] 智慧神龛（7:00 起每 7 分钟激活）
- **时间轴联动**：
  - [ ] 刷新倒计时标注
  - [ ] 当前时间点的赏金符价值计算

#### B2. 战略资源刷点
- **来源**：world-analysis 第 6 节「战略资源刷点」
- **新增图层**：
  - [ ] 肉山（坑位已有 FOW 数据，添加实体标注）
  - [ ] 折磨者（Tormentor）两个刷新点
- **时间轴联动**：
  - [ ] 肉山首刷 0:00，死亡后 8-11 分钟随机复活
  - [ ] 折磨者首刷 20:00，死亡后 10 分钟复活
- **详情面板**：
  - [ ] 击杀奖励（金钱/经验/掉落物）
  - [ ] 掉落物规则（神盾/奶酪/刷新碎片）

---

### Phase C：信息面板与表格

#### C1. 侧边信息面板
- **来源**：world-analysis 第 7 节「总体时间轴」
- **新增 UI**：
  - [ ] 地图右侧/底部可折叠信息面板
  - [ ] 随时间轴联动显示：
    - 当前分钟的兵线价值
    - 当前分钟的野怪总价值
    - 即将刷新的资源列表
    - 日夜状态

#### C2. 兵线经济（独立组件）
- **来源**：world-analysis 第 2 节「兵线金钱与经验」
- **建议**：
  - [ ] 保持为独立表格组件（`CreepEconomy.vue`）
  - [ ] 不整合到地图中（兵线是抽象概念，无明确位置）
  - [ ] 可在 `/pages/world/` 页面中独立展示

---

## 数据需求

| 数据文件 | 用途 | 状态 |
|----------|------|------|
| `neutrals.json` | 野怪经济数据（金钱/经验） | ⏳ 需扩展 |
| `buildings.json` | 建筑属性数据 | ⏳ 需创建 |
| `resources.json` | 中立资源刷新规则 | ⏳ 需创建 |
| `roshan.json` | 肉山数据 | ⏳ 需创建 |
| 赏金符/莲花池坐标 | 地图位置 | ⏳ 需从 VPK 提取 |

---

## 实施优先级

```
推荐顺序（按性价比排序）：

1. A3 移动时间显示增强  ← 最简单，一天完成
2. A1 野怪经济面板     ← 数据已有，添加浮窗
3. A2 建筑属性面板     ← 复用现有图层
4. B1 中立资源刷新     ← 需提取坐标数据
5. B2 肉山/折磨者      ← 需完善数据
6. C1 侧边信息面板     ← UI 工作量较大
7. C2 兵线经济         ← 独立组件，不急
```

---

## 架构变更

### 原计划文件结构（world-analysis-plan.md）
```
pages/world/index.vue
components/world/
  ├─ MapMoveSpeed.vue
  ├─ CreepEconomy.vue
  ├─ NeutralEconomy.vue
  ├─ BuildingStats.vue
  ├─ NeutralResources.vue
  ├─ StrategicPoints.vue
  └─ GlobalTimeline.vue
```

### 整合后建议结构
```
pages/world/index.vue           # 主入口，包含互动地图
components/world/
  ├─ InteractiveMap.vue         # 核心地图组件（已有）
  ├─ CreepEconomy.vue           # 独立兵线表格（保留）
  ├─ panels/                    # 地图侧边面板
  │   ├─ NeutralPanel.vue       # 野怪经济面板
  │   ├─ BuildingPanel.vue      # 建筑属性面板
  │   ├─ ResourcePanel.vue      # 资源刷新面板
  │   └─ TimelinePanel.vue      # 时间轴信息面板
  └─ layers/                    # 地图图层（已有架构）
      ├─ ResourceLayer.vue      # 赏金符/莲花池/神龛
      └─ BossLayer.vue          # 肉山/折磨者
```

---

## 待讨论事项

> [!IMPORTANT]
> **需要确认的设计决策：**

1. **兵线经济**是否真的需要放在地图上？还是保持独立表格更清晰？
2. **侧边面板**放右侧还是底部？是否需要可折叠？
3. **数据来源**：赏金符/莲花池/折磨者坐标是手动标注还是从 VPK 提取？
4. **移速计算**：是否需要支持多种移速（裸奔/跑鞋/相位/疾风步）快速切换？

---

## 参考文档

- [ward-simulator-plan.md](./ward-simulator-plan.md) - 眼位模拟器计划（互动地图基础）
- [world-analysis-plan.md](./world-analysis-plan.md) - 原世界分析计划
