# 技能伤害分析计划 v3

## 核心目标

基于已准备好的 `damage.json` 期望伤害数据，进行多维度的技能伤害分析。

---

## 数据源

| 文件 | 内容 | 用途 |
|------|------|------|
| `traits/damage.json` | 293个技能的期望伤害公式 | 主数据源 |
| `abilities.json` | 技能元数据 | 补充：CD、半径、行为类型 |
| `heroes.json` | 英雄数据 | 补充：英雄主属性 |

---

## 分析模块

### 模块一：技能伤害分布

**分析维度**：普通技能 vs 大招

| 统计项 | 普通技能 | 大招 | 对比 |
|--------|----------|------|------|
| 技能数量 | ? | ? | - |
| 平均期望伤害 | ? | ? | 大招/普通 = ? 倍 |
| 伤害中位数 | ? | ? | - |
| 伤害分布图 | 直方图 | 直方图 | - |

**可视化**：
- 双直方图对比（普通技能 vs 大招）
- 分位数标记（25%、50%、75%、90%）

---

### 模块二：按英雄属性分析

**分析维度**：力量 / 敏捷 / 智力 / 全能

| 英雄属性 | 普通技能平均伤害 | 大招平均伤害 | 设计假设 |
|----------|------------------|--------------|----------|
| 力量 | ? | ? | 偏控制/生存？ |
| 敏捷 | ? | ? | 偏物理输出？ |
| 智力 | ? | ? | 偏技能输出？ |
| 全能 | ? | ? | 均衡？ |

**验证假设**：
- 智力英雄技能伤害是否最高？
- 敏捷英雄技能伤害是否最低？（因为靠平A）

---

### 模块三：按目标类型分析

**分析维度**：单体技能 vs 范围技能

判断依据：
- 单体：`AbilityBehavior` 包含 `UNIT_TARGET` 且无 AOE 相关字段
- 范围：`AbilityBehavior` 包含 `AOE` 或有 `radius` 字段

| 目标类型 | 技能数 | 平均伤害 | 设计逻辑 |
|----------|--------|----------|----------|
| 单体 | ? | ? | 伤害更高？ |
| 范围 | ? | ? | 伤害更低？ |

**设计假设验证**：
- 单体技能伤害是否显著高于范围技能？（范围 vs 伤害的权衡）

---

### 模块四：技能出伤效率（DPS分析）★

**核心问题**：如何衡量技能的 DPS？

#### 4.1 DPS 定义

技能 DPS 不同于普攻 DPS，需要考虑：
- **冷却时间** (CD)
- **施法时间** (cast point)
- **持续伤害** (DoT duration)

#### 4.2 时间窗口 DPS 算法

**定义**：在 T 秒内，技能能打出的总伤害 / T

**公式**：
```
DPS(T) = Damage × N(T) / T

其中：
- Damage = 单次期望伤害
- N(T) = 在 T 秒内能释放的次数 = floor(T / CD) + 1  // 0秒释放第一次
- T = 时间窗口
```

#### 4.3 时间窗口选择

| 时间窗口 | 游戏阶段 | 意义 |
|----------|----------|------|
| **3秒 DPS** | 瞬间爆发 | 能打出几技能？ |
| **10秒 DPS** | 一次Gank | 标准团战时长 |
| **30秒 DPS** | 持续战斗 | 多次技能循环 |
| **60秒 DPS** | 极限续航 | 理论最大输出 |

**选择理由**：
- 3秒：一次秒人的时间窗口
- 10秒：标准团战时长
- 30秒：考验CD较长技能的价值
- 60秒：理论输出能力

#### 4.4 DPS 示例计算

假设技能：伤害 300，CD 12 秒

| 时间窗口 | 释放次数 | 总伤害 | DPS |
|----------|----------|--------|-----|
| 3秒 | 1 | 300 | 100 |
| 10秒 | 1 | 300 | 30 |
| 30秒 | 3 | 900 | 30 |
| 60秒 | 6 | 1800 | 30 |

**注意**：CD 较长时，DPS 趋向于 `Damage / CD`

#### 4.5 DPS 分析表格

| 技能 | 伤害 | CD | 3s DPS | 10s DPS | 30s DPS | 评级 |
|------|------|-----|--------|---------|---------|------|
| ... | ... | ... | ... | ... | ... | ... |

**排序方式**：
- 按 3s DPS 排序 → 找出爆发型技能
- 按 30s DPS 排序 → 找出持续输出型技能
- 按 伤害/CD 排序 → 理论效率

#### 4.6 DPS 可视化

- **散点图**：X轴=CD，Y轴=单次伤害，点大小=DPS
- **雷达图**：对比不同时间窗口的 DPS 排名

---

## 模块优先级

| 优先级 | 模块 | 复杂度 | 价值 |
|--------|------|--------|------|
| P0 | 技能伤害分布 | 低 | 建立基础认知 |
| P0 | 按英雄属性分析 | 低 | 验证设计假设 |
| P1 | 按目标类型分析 | 中 | 需判断单体/范围 |
| P1 | DPS 分析 | 中 | 核心创新点 |

---

## 技术实现思路

### composable: useAbilityDamageAnalyzer

```typescript
// 基于 damage.json 的分析器
export const useAbilityDamageAnalyzer = () => {
  // 1. 加载 damage.json + abilities.json + heroes.json
  
  // 2. 计算单个技能的期望伤害（各等级）
  const calculateDamage = (abilityName: string, level: number) => {}
  
  // 3. 按维度分组
  const groupByUltimate = () => {}       // 普通 vs 大招
  const groupByAttribute = () => {}      // 英雄属性
  const groupByTargetType = () => {}     // 单体 vs 范围
  
  // 4. DPS 计算
  const calculateDPS = (damage: number, cd: number, timeWindow: number) => {
    const casts = Math.floor(timeWindow / cd) + 1
    return (damage * casts) / timeWindow
  }
  
  // 5. 统计函数
  const getStats = (damages: number[]) => {
    return {
      mean: average(damages),
      median: median(damages),
      p25: percentile(damages, 25),
      p75: percentile(damages, 75),
      p90: percentile(damages, 90)
    }
  }
}
```

### 页面结构

```
pages/abilities.vue
├── Tab: 伤害分布
│   ├── 普通技能 vs 大招
│   └── 分布直方图
├── Tab: 英雄属性分析
│   └── 力/敏/智/全能 四象限图
├── Tab: 目标类型分析
│   └── 单体 vs 范围
└── Tab: DPS 分析
    ├── 排行榜（多时间窗口）
    └── 散点图（CD vs 伤害）
```

---

## 待确认问题

1. **各等级取哪个？**
   - 建议：4级普通技能、3级大招（满级数据）

2. **DoT 技能如何处理？**
   - 建议：总伤害 = 每跳伤害 × 跳数，已在 damage.json 中体现

3. **多次命中技能如何处理？**
   - 建议：期望命中数，已在 damage.json 中体现

4. **是否考虑魔法抗性？**
   - 建议：否，只看原始伤害
