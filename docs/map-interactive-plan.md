# 交互式地图功能计划

## 愿景

将交互地图发展为 **Dota 2 数据沙盘**，作为数据分析结果的可视化呈现方式，让用户能够直观探索和验证分析结论。

---

## 沙盘发展层次

### 层次一：静态可视化 ✅ 基本完成
> 在地图上展示数据分析的结论

- [x] 地图底图（地势图 + 导航网格）
- [x] 滚轮缩放 + 中键拖拽
- [x] 野怪营地显示（28 个）
- [x] 建筑显示（前哨/泉水/遗迹）
- [x] 树木显示（2456 棵）
- [ ] 防御塔显示
- [ ] 经验神龛显示
- [ ] 神符显示（4个神符点）
- [ ] 寻路路径 + 移动时间计算，考虑树木障碍
- [ ] 点击野怪营地查看详情（经济、经验等）
- [ ] 点击建筑查看详情

**解决问题**："这个位置有什么"、"从 A 到 B 要多久"

---

### 层次二：参数化推演 ⬅️ 本期目标
> 用户调整参数，动态计算结果

- [ ] **移速参数化**：选择英雄移速，动态更新移动时间
- [ ] **时间轴控制**：选择游戏时间点，显示该时刻的状态
  - 兵线位置
  - 野怪刷新状态
  - 赏金符/经验符状态
- [ ] **动态障碍物**：
  - 砍树后路径变化
  - 摧毁建筑后路径变化
- [ ] **多点路线规划**：刷野顺序优化
- [ ] **刷野效率计算**：GPM/XPM 分析

**解决问题**："如果...会怎样"、"最优方案是什么"

---

### 层次三：场景模拟（远期愿景）
> 模拟特定场景的动态过程

- [ ] 放置英雄，模拟视野覆盖
- [ ] 放置眼位，分析视野盲区
- [ ] 团战站位推演
- [ ] 录像叠加回放
- [ ] 实时对战模拟

**解决问题**："这个战术怎么执行"

---

## 当前状态

### 已完成 ✅
- 地势图生成（含斜坡标记）
- 导航图生成（桥梁识别）
- 地图缩放/平移交互
- A* 寻路算法实现
- 实体数据拆分（`split-mapdata.cjs`）
- 图层显示（树木/野怪/建筑）

### 待完成
- [ ] 野怪营地类型标注（`neutral-camp-types.json`）
- [ ] 防御塔阵营着色
- [ ] 点击元素显示详情面板
- [ ] 时间轴控制组件
- [ ] 动态障碍物系统

---

## 数据架构

```
public/data/world/
├── entities/              # 脚本拆分的实体数据
│   ├── trees.json
│   ├── neutral-spawners.json
│   ├── towers.json
│   ├── forts.json
│   ├── fountains.json
│   └── outposts.json
├── custom/                # 手动补充数据
│   └── neutral-camp-types.json
├── neutrals.json          # 野怪详细属性
├── buildings.json         # 建筑详细属性
└── creeps.json            # 兵线数据

public/images/map/{version}/
├── elevation.png          # 地势图（地图背景）
└── gridnav.png            # 导航数据
```

---

## 里程碑

- [x] **M0 - 基础设施**：地图渲染 + 寻路 + 数据拆分
- [ ] **M1 - 静态完善**：详情面板 + 营地类型 ⬅️ 当前
- [ ] **M2 - 时间轴**：时间参数 + 状态联动
- [ ] **M3 - 动态障碍**：砍树/推塔对寻路的影响
- [ ] **M4 - 路线优化**：多点规划 + 效率计算

---

## 已解决的技术问题

1. **桥梁识别**：多高度层检测策略
2. **斜坡可视化**：相邻格子高度差检测
3. **大数据输出**：位图/网格格式编码
4. **导航图透明化**：前端像素处理
