# 眼位模拟器计划

> 基于交互式地图的眼位放置与视野可视化工具

---

## 目标

构建一个 **Dota 2 眼位模拟器**，支持：
1. 在地图上放置真眼/假眼
2. 实时显示视野覆盖范围
3. 考虑高地遮挡和日夜视野差异

---

## 功能清单

### Phase 1: 实体信息层 (M1) ✅ 完成

- [x] 点击实体显示详情浮窗
- [x] 野怪营地类型标注（小/中/大/远古）
- [x] 根据类型显示不同大小和颜色

### Phase 2: 地图完善 ✅ 完成

- [x] 图标雪碧图系统
  - [x] `icons-config.json` 36 个图标配置
  - [x] 颜色叠加渲染（tintColor + 缓存）
  - [x] 背景透明化处理
- [x] 野怪营地图标（小/中/大/远古）
- [x] 建筑图标（前哨/遗迹）
- [x] 防御塔图标（中路/边路）
- [x] 神符点图标

> [!NOTE]
> **待补充元素**（图标已配置，渲染逻辑待实现）：
> 肉山、神秘商店、基地商店、高地普通建筑、传送门、经验神龛、痛苦魔方、观察者（Tormentor）

### Phase 3: 时间轴系统 ✅ 完成

- [x] 右键菜单系统
  - [x] 野怪营地：清野/恢复
  - [x] 树木：砍树/恢复
  - [x] 空白区域：设为起点/终点/清除路径
- [x] 时间条控制（0:00 ~ 60:00）
  - [x] 播放/暂停按钮
  - [x] 时间滑块拖拽
  - [x] 速度选择（1x/2x/4x）
- [x] 日夜循环（每5分钟切换）
  - [x] 夜间蓝色遮罩效果
  - [x] 日夜图标指示器
- [x] 野怪清野状态
  - [x] 灰色半透明显示
  - [x] 已清营地计数

### Phase 4: 视野系统 🔧 进行中

#### 4.1 基础功能 ✅ 已完成
- [x] 眼位放置交互（真眼/假眼）
- [x] 视野圈渲染（考虑高地遮挡）
- [x] 日夜视野差异（白天1600/夜间800）
- [x] 多眼位视野叠加显示
- [ ] 树木砍伐与视野联动
  - [ ] 砍掉的树木位置可放置眼位
  - [ ] 砍掉的树木不再阻挡视野

#### 4.2 战争迷雾与样式优化
- [ ] 天辉/夜魇战争迷雾开关
  - [ ] 可选择查看天辉/夜魇视角
  - [ ] 有视野的地方消除战争迷雾
- [ ] 眼位视野显示样式
  - [ ] 左键选中眼位时显示黄色视野圈
  - [ ] 点击空白处取消选中，只显示战争迷雾效果
  - [ ] 未选中状态下视野更简洁舒适
- [ ] 拖动眼位功能
  - [ ] 选中眼位后可拖动调整位置
  - [ ] 拖动时实时更新视野范围

#### 4.3 阵营区分
- [ ] 插眼功能区分天辉/夜魇
  - [ ] 可切换当前操作阵营
  - [ ] 不同阵营眼位使用不同颜色标识

#### 4.4 建筑视野
- [ ] 防御塔视野
- [ ] 基地建筑视野

#### 4.5 视野阻挡点
- [ ] 从 `ent_fow_blocker_node.png` 提取视野阻挡点数据
- [ ] 生成对应 JSON 数据
- [ ] 应用到视野计算中

#### 4.6 性能优化
- [ ] 插眼后拖动地图卡顿问题
  - [ ] 减少不必要的重绘
  - [ ] 视野计算缓存优化

---

## 数据需求

| 数据 | 来源 | 状态 |
|------|------|------|
| elevation.png | dota-map-coordinates | ✅ 已有 |
| 野怪营地类型 | 手动标注 | ✅ 完成 |
| 传送门/莲花池等 | VPK 提取 | ⏳ 待提取 |
| Dota 图标 | 游戏资源 | ⏳ 待提取 |

---

## 进度跟踪

- [x] M0 基础设施
- [x] M1 实体信息层
- [x] Phase 2 地图完善
- [x] Phase 3 时间轴系统
- [ ] Phase 4 视野系统
